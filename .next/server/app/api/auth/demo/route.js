"use strict";(()=>{var e={};e.id=182,e.ids=[182],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4770:e=>{e.exports=require("crypto")},6005:e=>{e.exports=require("node:crypto")},9002:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>f,patchFetch:()=>w,requestAsyncStorage:()=>p,routeModule:()=>_,serverHooks:()=>g,staticGenerationAsyncStorage:()=>m});var a={};r.r(a),r.d(a,{POST:()=>d,runtime:()=>u});var o=r(9303),n=r(8716),s=r(670),i=r(7070),l=r(1279),c=r(6939);let u="nodejs";async function d(){try{let e=await (0,c.getUserById)("demo_user_123");e||(e=await (0,c.createUser)({google_id:"demo_user_123",name:"Demo User",email:"demo@sqlquest.com",avatar:"https://via.placeholder.com/40"})),await (0,c.updateUserLogin)("demo_user_123");let t=process.env.SESSION_SECRET||"sql-mastery-quest-secret",r=(0,l.encode)({sub:e.google_id,name:e.name,email:e.email},t),a=i.NextResponse.json({user:e,message:"Demo mode activated"});return a.headers.set("Set-Cookie",`auth_token=${r}; ${(0,l.cookieOptions)({})}`),a}catch(e){return i.NextResponse.json({error:"Demo setup failed"},{status:500})}}let _=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/auth/demo/route",pathname:"/api/auth/demo",filename:"route",bundlePath:"app/api/auth/demo/route"},resolvedPagePath:"/Users/devang/Desktop/sql_tutor/app/api/auth/demo/route.js",nextConfigOutput:"",userland:a}),{requestAsyncStorage:p,staticGenerationAsyncStorage:m,serverHooks:g}=_,f="/api/auth/demo/route";function w(){return(0,s.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:m})}},1279:(e,t,r)=>{let a=r(4770);function o(e){return Buffer.from(e).toString("base64").replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function n(e,t){return o(a.createHmac("sha256",t).update(e).digest())}e.exports={encode:function(e,t,r=2592e3){let a=Math.floor(Date.now()/1e3),s={iat:a,exp:a+r,...e},i=o(JSON.stringify({alg:"HS256",typ:"JWT"})),l=o(JSON.stringify(s)),c=`${i}.${l}`,u=n(c,t);return`${c}.${u}`},verify:function(e,t){try{let r=e.split(".");if(3!==r.length)return null;let[a,o,s]=r,i=n(`${a}.${o}`,t);if(s!==i)return null;let l=JSON.parse(Buffer.from(o,"base64").toString("utf8"));if(l.exp&&Math.floor(Date.now()/1e3)>l.exp)return null;return l}catch{return null}},decode:function(e){try{let[,t]=e.split(".");return JSON.parse(Buffer.from(t,"base64").toString("utf8"))}catch{return null}},cookieOptions:function({maxAge:e=2592e3}={}){return["Path=/","HttpOnly","SameSite=Lax","Secure",`Max-Age=${e}`].filter(Boolean).join("; ")}}},6939:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0});let a=r(6649),o={USER:e=>`users:${e}`,USER_PROGRESS:(e,t,r)=>`progress:${e}:${t}:${r}`,DAILY_MISSIONS:(e,t)=>`missions:${e}:${t}`,WEEKLY_QUEST:(e,t)=>`weekly_quest:${e}:${t}`,STREAK_RECOVERY:e=>`streak_recovery:${e}`,DAILY_REFLECTION:(e,t)=>`reflection:${e}:${t}`},n=()=>new Date().toISOString().split("T")[0],s=()=>{let e=new Date;return new Date(e.getFullYear(),e.getMonth(),e.getDate()-e.getDay()).toISOString().split("T")[0]};async function i(e){try{return await a.kv.get(o.USER(e))}catch(e){return console.error("Error getting user:",e),null}}async function l({google_id:e,name:t,email:r,avatar:s}){try{let i=n(),l={id:e,google_id:e,name:t,email:r,avatar:s,total_xp:0,level:1,current_streak:1,max_streak:1,last_login:i,streak_shields:0,created_at:new Date().toISOString(),updated_at:new Date().toISOString()};return await a.kv.set(o.USER(e),l),l}catch(e){throw console.error("Error creating user:",e),e}}async function c(e){try{let t=await i(e);if(!t)return;let r=n(),s=t.current_streak||1,l=t.streak_shields||0;if(t.last_login){let a=new Date(t.last_login),o=new Date(r),n=Math.floor((o-a)/864e5);if(1===n)(s+=1)%7==0&&l<1&&(l+=1);else if(n>2){if(l>0)l-=1;else{let t=s;t>=7&&await u(e,t),s=1}}else if(2===n&&0===l){let t=s;t>=7&&await u(e,t),s=1}}let c={...t,last_login:r,current_streak:s,max_streak:Math.max(t.max_streak||1,s),streak_shields:l,updated_at:new Date().toISOString()};return await a.kv.set(o.USER(e),c),c}catch(e){throw console.error("Error updating user login:",e),e}}async function u(e,t){try{let r=new Date;r.setDate(r.getDate()+2);let n=new Date;n.setDate(n.getDate()-30);let s=await a.kv.get(o.STREAK_RECOVERY(e));if(s&&s.recovery_used&&new Date(s.created_at)>n)return;let i={user_id:e,broken_streak:t,recovery_deadline:r.toISOString().split("T")[0],recovery_missions_needed:5,recovery_missions_completed:0,recovery_used:!1,created_at:new Date().toISOString()};await a.kv.set(o.STREAK_RECOVERY(e),i)}catch(e){console.error("Error creating streak recovery:",e)}}async function d(e){try{let t=await i(e);if(!t)return{};return{completed_questions:(await a.kv.keys(`progress:${e}:*`)).length,total_xp:t.total_xp||0,current_streak:t.current_streak||0,max_streak:t.max_streak||0,streak_shields:t.streak_shields||0,level:t.level||1}}catch(e){return console.error("Error getting user stats:",e),{}}}async function _(e){try{let t=await a.kv.keys(`progress:${e}:*`),r=[];for(let e of t){let t=await a.kv.get(e);t&&r.push(t)}return r.sort((e,t)=>e.level_id!==t.level_id?e.level_id-t.level_id:e.question_id-t.question_id)}catch(e){return console.error("Error getting user progress:",e),[]}}async function p(e,t,r){try{let n=await i(e);if(!n)return{total_xp:0,level:1};if(t&&r>0){let t=(n.total_xp||0)+r,s=Math.floor(.1*Math.sqrt(t)+1),i={...n,total_xp:t,level:s,updated_at:new Date().toISOString()};return await a.kv.set(o.USER(e),i),{total_xp:t,level:s}}return{total_xp:n.total_xp||0,level:n.level||1}}catch(e){return console.error("Error updating user totals:",e),{total_xp:0,level:1}}}async function m(e,{level_id:t,question_id:r,completed:n,xp_earned:s,hints_used:i}){try{let l=o.USER_PROGRESS(e,t,r),c=await a.kv.get(l);if(c){let e={...c,completed:n,attempts:(c.attempts||0)+1,hints_used:(c.hints_used||0)+i,xp_earned:(c.xp_earned||0)+s,completed_at:n?new Date().toISOString():c.completed_at};await a.kv.set(l,e)}else{let o={user_id:e,level_id:t,question_id:r,completed:n,attempts:1,hints_used:i,xp_earned:s,completed_at:n?new Date().toISOString():null};await a.kv.set(l,o)}return p(e,n,s)}catch(e){throw console.error("Error upserting user progress:",e),e}}async function g(e){try{let t=s(),r=o.WEEKLY_QUEST(e,t),n=await a.kv.get(r);return n||(n={id:`${e}-${t}`,user_id:e,week_start:t,missions_target:12,missions_completed:0,completed:!1,reward_claimed:!1},await a.kv.set(r,n)),n}catch(e){return console.error("Error getting weekly quest:",e),null}}async function f(e){try{let t=s(),r=o.WEEKLY_QUEST(e,t),n=await a.kv.get(r);if(!n)return{reward:null};let l={...n,missions_completed:n.missions_completed+1,completed:n.missions_completed+1>=n.missions_target};await a.kv.set(r,l);let c=null;if(l.completed&&!l.reward_claimed){if("shield"==(.5>Math.random()?"shield":"xp")){let t=await i(e),r={...t,streak_shields:(t.streak_shields||0)+1,updated_at:new Date().toISOString()};await a.kv.set(o.USER(e),r),c="1 Streak Shield"}else{let t=await i(e),r=(t.total_xp||0)+200,n={...t,total_xp:r,level:Math.floor(.1*Math.sqrt(r)+1),updated_at:new Date().toISOString()};await a.kv.set(o.USER(e),n),c="200 XP"}l.reward_claimed=!0,await a.kv.set(r,l)}return{reward:c}}catch(e){return console.error("Error completing weekly quest:",e),{reward:null}}}async function w(e,t){try{let r=o.DAILY_MISSIONS(e,t),n=await a.kv.get(r);if(!n){let o=[];for(;o.length<3;)o.push({level_id:Math.floor(11*Math.random())+1,question_id:Math.floor(4*Math.random())+1});n={user_id:e,mission_date:t,question_1_id:`${o[0].level_id}-${o[0].question_id}`,question_2_id:`${o[1].level_id}-${o[1].question_id}`,question_3_id:`${o[2].level_id}-${o[2].question_id}`,completed_count:0},await a.kv.set(r,n)}return n}catch(e){return console.error("Error getting daily missions:",e),null}}async function S(e,t,r,n){try{let i=await w(e,n);if(!i)return{completed_count:0};let l=`${t}-${r}`,c=i.completed_count;if(i.question_1_id===l&&i.completed_count<1?c=1:i.question_2_id===l&&i.completed_count<2?c=2:i.question_3_id===l&&i.completed_count<3&&(c=3),c>i.completed_count){i.completed_count=c,await a.kv.set(o.DAILY_MISSIONS(e,n),i);let t=s(),r=o.WEEKLY_QUEST(e,t),l=await a.kv.get(r);l&&(l.missions_completed=l.missions_completed+1,l.completed=l.missions_completed>=l.missions_target,await a.kv.set(r,l))}return{completed_count:Math.max(c,i.completed_count)}}catch(e){return console.error("Error completing daily mission:",e),{completed_count:0}}}async function v(e){try{let t=await a.kv.get(o.STREAK_RECOVERY(e));if(!t)return null;let r=new Date(t.recovery_deadline),n=new Date;if(t.recovery_used||r<n)return null;return t}catch(e){return console.error("Error getting streak recovery:",e),null}}async function h(e){try{let t=await v(e);if(!t)return{completed:!1};if(t.recovery_missions_completed=t.recovery_missions_completed+1,await a.kv.set(o.STREAK_RECOVERY(e),t),t.recovery_missions_completed>=5){let r=Math.floor(t.broken_streak/2),n={...await i(e),current_streak:r,updated_at:new Date().toISOString()};return await a.kv.set(o.USER(e),n),t.recovery_used=!0,await a.kv.set(o.STREAK_RECOVERY(e),t),{completed:!0,restored_streak:r}}return{completed:!1}}catch(e){return console.error("Error completing streak recovery mission:",e),{completed:!1}}}async function y(e,t){try{return await a.kv.get(o.DAILY_REFLECTION(e,t))}catch(e){return console.error("Error getting daily reflection:",e),null}}async function k(e,t,r){try{let n={user_id:e,reflection_date:r,takeaway:t,created_at:new Date().toISOString()};await a.kv.set(o.DAILY_REFLECTION(e,r),n)}catch(e){throw console.error("Error saving daily reflection:",e),e}}async function E(e){try{let t=new Date,r=new Date(t.getTime()-6048e5).toISOString().split("T")[0],o=await a.kv.keys(`reflection:${e}:*`),n=[];for(let e of o){let t=await a.kv.get(e);t&&t.reflection_date>=r&&n.push(t)}return n.sort((e,t)=>new Date(t.reflection_date)-new Date(e.reflection_date))}catch(e){return console.error("Error getting weekly recap:",e),[]}}e.exports={getUserById:i,createUser:l,updateUserLogin:c,getUserStats:d,getUserProgress:_,upsertUserProgress:m,getWeeklyQuest:g,completeWeeklyQuest:f,getDailyMissions:w,completeDailyMission:S,getStreakRecovery:v,completeStreakRecoveryMission:h,getDailyReflection:y,saveDailyReflection:k,getWeeklyRecap:E}}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[276,972,649],()=>r(9002));module.exports=a})();