---
description: "Security rules"
globs: ["server/**/*.js", "server.js"]
alwaysApply: true
---

# Security

## Must
- "Replace app.use(cors()) with a whitelist of origins from env (CORS_ORIGINS)"
- "Add helmet with sane defaults and contentSecurityPolicy for client pages"
- "Harden session cookies: httpOnly: true, sameSite: 'lax' or 'strict'; secure: true in production"
- "Never expose secrets or stack traces in API responses"
- "Validate all request bodies, params, and query strings with a schema validator (e.g., zod/joi)"
- "For /setup-mysql, strictly validate database name and all inputs; deny if not matching ^[a-zA-Z0-9_]+$"
- "Disable directory listing and ensure static serve does not expose server code"
- "Set MySQL multipleStatements=false"

## Should
- "Add rate limiting to /auth/* and /execute-query (e.g., 10 req/min per IP/user)"
- "Use CSRF protection for state-changing endpoints if browser-based session auth is used"

## Avoid
- "Expanding allowed SQL beyond SELECT/EXPLAIN for user-submitted queries"
